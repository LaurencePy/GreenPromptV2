(()=>{"use strict";console.log("%%%% POPUP.JS API MODE - START - v2.3 (google-t5/t5-small) %%%%");const t="https://api-inference.huggingface.co/models/google-t5/t5-small";document.addEventListener("DOMContentLoaded",(()=>{console.log("%%%% DOMContentLoaded event fired - API v2.3 (google-t5/t5-small) %%%%");const e=document.getElementById("prompt-input"),n=document.getElementById("optimize-btn"),o=document.getElementById("status"),r=document.getElementById("optimized-output");if(!n)return console.error("Element with ID 'optimize-btn' not found!"),void(o&&(o.textContent="Error: Optimize button not found in HTML."));o&&(o.textContent="Ready. Enter a prompt to optimize."),n.disabled=!1,n.addEventListener("click",(async()=>{console.log("%%%% Optimize button clicked - API v2.3 (google-t5/t5-small) %%%%");const s=e.value;if(s.trim()){o&&(o.textContent="Rewriting prompt via API..."),r&&(r.textContent=""),n.disabled=!0;try{const e=await async function(e){const n=document.getElementById("status"),o=e.split(/\s+/).length;let r=Math.max(3,Math.floor(.2*o)),s=Math.max(5,Math.floor(.6*o));o<10&&(r=Math.max(1,Math.floor(.4*o)),s=o),o<5&&(r=1,s=o+1);const a={inputs:`summarize: ${e}`,parameters:{min_length:r,max_length:s,temperature:.7,num_beams:4,early_stopping:!0,length_penalty:2}};console.log(`Sending to Hugging Face (${t}):`,JSON.stringify(a,null,2)),n&&(n.textContent="Calling T5 API (summarize)...");const i=await fetch(t,{method:"POST",headers:{Authorization:"Bearer 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","Content-Type":"application/json"},body:JSON.stringify(a)});if(!i.ok){const t=await i.text();console.error(`Hugging Face API Error (${i.status}): ${i.statusText}`,t);let e="API request failed.";try{const n=JSON.parse(t);n.error?e=n.error:n.detail&&(e=n.detail)}catch(n){e=t.substring(0,200)}throw new Error(`Hugging Face API error (${i.status}). Details: ${e}`)}const l=await i.json();console.log("Hugging Face API Result:",l);let g=l[0]?.summary_text||l[0]?.generated_text;if(g)return g=g.trim(),!g||g.length<2?(n&&(n.textContent="API did not provide a substantial rewrite. Using original."),e):g;{const t=JSON.stringify(l,null,2).substring(0,300);if(console.warn("Unexpected API response structure:",t),l[0]?.translation_text)throw console.warn("API returned 'translation_text' again:",l[0].translation_text),new Error(`API seems to be translating. Got: ${l[0].translation_text.substring(0,50)}...`);throw new Error(`No 'summary_text' or 'generated_text' in API response. Got: ${t}...`)}}(s);r&&(r.textContent=e),o&&(o.textContent="Prompt rewritten successfully!")}catch(t){console.error("Error during API call or processing:",t),r&&(r.textContent=`Error: ${t.message}`),o&&(o.textContent="Failed to rewrite prompt.")}finally{n.disabled=!1}}else o&&(o.textContent="Please enter a prompt.")})),console.log("%%%% Event listener attached to optimize-btn - API v2.3 (google-t5/t5-small) %%%%")})),console.log("%%%% POPUP.JS SCRIPT BOTTOM - API v2.3 (google-t5/t5-small) %%%%")})();