(()=>{"use strict";console.log("%%%% POPUP.JS API MODE - START - v2.4 (Mixtral/Instruction) %%%%");const t="https://api-inference.huggingface.co/models/mistralai/Mixtral-8x7B-Instruct-v0.1";document.addEventListener("DOMContentLoaded",(()=>{console.log("%%%% DOMContentLoaded event fired - API v2.4 (Mixtral) %%%%");const e=document.getElementById("prompt-input"),n=document.getElementById("optimize-btn"),o=document.getElementById("status"),r=document.getElementById("optimized-output");if(!n)return console.error("Element with ID 'optimize-btn' not found!"),void(o&&(o.textContent="Error: Optimize button not found in HTML."));o&&(o.textContent="Ready. Enter a prompt to optimize."),n.disabled=!1,n.addEventListener("click",(async()=>{console.log("%%%% Optimize button clicked - API v2.4 (Mixtral) %%%%");const i=e.value;if(i.trim()){o&&(o.textContent="Rewriting prompt via Mixtral API..."),r&&(r.textContent=""),n.disabled=!0;try{const e=await async function(e){const n=document.getElementById("status"),o={inputs:`You are a prompt optimizer. Rewrite the following prompt to be shorter, simpler, and more concise using the fewest possible tokens while keeping the intent. Do NOT answer the question, only rewrite the prompt: "${e}"`,parameters:{max_new_tokens:60,temperature:.7,top_p:.95,do_sample:!0}};console.log(`Sending to Hugging Face (${t}):`,JSON.stringify(o,null,2)),n&&(n.textContent="Calling Mixtral Rewriter API...");const r=await fetch(t,{method:"POST",headers:{Authorization:"Bearer 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","Content-Type":"application/json"},body:JSON.stringify(o)});if(!r.ok){const t=await r.text();console.error(`Hugging Face API Error (${r.status}): ${r.statusText}`,t);let e="API request failed.";try{const n=JSON.parse(t);n.error?e=n.error:n.detail&&(e=n.detail)}catch(n){e=t.substring(0,200)}throw new Error(`Hugging Face API error (${r.status}). Details: ${e}`)}const i=await r.json();console.log("Hugging Face API Result:",i);let s=i[0]?.generated_text||i.generated_text;if(s)return s=s.trim(),s.length>1?s:e;{const t=JSON.stringify(i,null,2).substring(0,300);throw new Error(`No usable result returned. Got: ${t}...`)}}(i);r&&(r.textContent=e),o&&(o.textContent="Prompt rewritten successfully!")}catch(t){console.error("Error during Mixtral API call or processing:",t),r&&(r.textContent=`Error: ${t.message}`),o&&(o.textContent="Failed to rewrite prompt.")}finally{n.disabled=!1}}else o&&(o.textContent="Please enter a prompt.")})),console.log("%%%% Event listener attached to optimize-btn - API v2.4 (Mixtral) %%%%")})),console.log("%%%% POPUP.JS SCRIPT BOTTOM - API v2.4 (Mixtral) %%%%")})();